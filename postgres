# Setup variables
mysql_data_dir=$SCRIPT_DIR/db
DATABASE_FILE=$SCRIPT_DIR/database.sql
mkdir -p $mysql_data_dir

# Reset database if started with hard
if [ $hard = "1" ]; then
    # Remove old database and create new one
    rm -rf $mysql_data_dir
    mkdir -p $mysql_data_dir
    pg_ctl -D "$mysql_data_dir" -o "--username=$USER" init

    # Set Unix socket location
    sed -i 's|#unix_socket_directories = '\''/var/run/postgresql, /tmp'\''|unix_socket_directories = '\'$mysql_data_dir\''|g' $mysql_data_dir/postgresql.conf
fi

# Start the server
pg_ctl \
-D "$mysql_data_dir" \
start

if [ $hard = "1" ]; then
    # Create the database from the json file
    psql -h localhost -U $USER -d postgres -c "CREATE DATABASE database;"
    psql -h localhost -U $USER -d database -f "$DATABASE_FILE"
fi
